<script type="text/javascript">
  const APP_URL = 'https://app.put.io'

  function handleContextMenu(event) {
    if (event.userInfo && event.userInfo.nodeName === 'A') {
      event.contextMenu.appendContextMenuItem('putio-download', 'Download with Put.io')
    }
  }

  function openTab(url, activate) {
    safari.application.activeBrowserWindow.openTab(activate ? 'foreground' : 'background').url = url
  }

  function performCommand(event) {
    if (event.command === 'putio-download') {
      return openTab(APP_URL + '/magnet?url=' + encodeURIComponent(event.userInfo.href), false)
    }

    if (event.command === 'putio-click') {
      return openTab(APP_URL, true)
    }
  }

  safari.application.addEventListener("command", performCommand, false)
  safari.application.addEventListener('contextmenu', handleContextMenu, false)
</script>

